tables:
  account_req:
    fields:
      id: {type: int, length: 10, unsigned: 1, auto_increment: 1, notnull: 1, am: {type: integer, title: Номер}}
      req_num: {type: tinytext, am: {type: string, title: Номер заявки}}
      req_status: {type: enum('yes','no'), default: 'no', notnull: 1, am: {type: string, title: Отправлено, htmltype: checkbox, default: 'no', checked: 'yes', unchecked: 'no', values: {no: нет, yes: да}}}
      created: {type: date, notnull: 1, am: {type: date, req: 1, title: Дата заявки}}
#      url: {type: tinytext, am: {type: string, title: URL}}
      contact: {type: tinytext, notnull: 1, am: {type: string, req: 1, title: Контактное лицо}}
#      phone: {type: tinytext, notnull: 1, am: {type: string, req: 1, title: Контактный телефон}}
      mail: {type: tinytext, notnull: 1, am: {type: mail, req: 1, title: Контактный e-mail}}
      bank_id: {am: {type: select, null: Не выбран, title: Банк, req: 1}}
      currency_id: {am: {type: select, null: Не выбрана, title: Валюта счета}}
      user_id: {type: int, notnull: 1, unsigned: 1, am: {type: select, title: Пользователь}}
      turnover: {type: int, notnull: 0, am: {type: integer, title: Ожидаемый оборот, attrs: {maxlength: 9}}}
      country_source: 
        virtual: 1
        ref_to:
          virtual: 1
          table: country_source
          fields: [id, title]
          use_ref: accounts2country_source
        am: {type: checkboxes, title: Страны источники входящих денежных переводов, del: ' ', field_name: title, title_field: title, alias: country_source}
      country_receiver:
        virtual: 1
        ref_to:
          virtual: 1
          table: country_receiver
          fields: [id, title]
          use_ref: accounts2country_receiver
        am: {type: checkboxes, title: Страны назначения исходящих денежных переводов, del: ' ', field_name: title, title_field: title, alias: country_receiver}
      sources:
        virtual: 1
        ref_to:
          virtual: 1
          table: sources
          fields: [id, title]
          use_ref: account2sources
        am: {type: checkboxes, title: Источники происхождения ДС, del: ' ', field_name: title, title_field: title}
      own_sources: {type: text, am: {type: text, title: Свои источники происхождения ДС}}

    table:
      PRIMARY KEY: id
    foreign:
      bank: {table: banks, field: title, use_ref: accounts2banks}
    actions:
      list: [id, created, req_num, req_status, contact, mail, turnover, sources, own_sources]
      show: [created, req_num, req_status, contact, mail, turnover, country_source, country_receiver, sources, own_sources]
      modify: [req_num, req_status, contact, mail, turnover, country_receiver, country_source, sources, own_sources]
      add: [req_num, req_status, contact, mail, turnover, country_source, country_receiver, sources, own_sources]
      site_form: [contact, mail, bank_id, currency_id, turnover, country_source, country_receiver, sources, own_sources]
      site_form_check: [contact, mail, turnover, country_source, country_receiver, sources, own_sources]
      site_mail: [contact, mail, turnover, country_source, country_receiver, sources, own_sources]
      cabinet: [id, created, turnover]
      showorder: [id, created, contact, mail, turnover, country_source, country_receiver, sources, own_sources]

  banks:
    dont_install: 1
    fields:
      id: {type: int, length: 10, auto_increment: 1, notnull: 1, am: {type: integer}}
      title: {type: tinytext, notnull: 1, am: {type: string, req: 1, title: Название}}
      pos: {type: int, length: 10, unsigned: 1, notnull: 1, am: {type: integer, htmltype: hidden}}
      code: {type: varchar, length: '255', notnull: 1, am: {type: string, req: 1, title: SWIFT-код, trimNE: 'Поле "Код" не должно быть пустым'}}
      currencies:
        virtual: 1
        ref_to:
          virtual: 1
          table: currencies
          fields: [id, title]
          use_ref: banks2currencies
        am: {type: checkboxes, title: Валюта, del: ' ', field_name: title, title_field: title}
      active: {type: enum('yes','no'), default: 'yes', notnull: 1, am: {type: checkbox, title: Отображать на сайте, otitle: Отображать на сайте, default: 'yes', checked: 'yes', unchecked: 'no', values: {no: нет, yes: да}}}

  currencies:
    dont_install: 1
    fields:
      id: {type: int, length: 10, auto_increment: 1, notnull: 1, am: {type: integer}}
      title: {type: tinytext, notnull: 1, am: {type: string, req: 1, title: Название}}
      pos: {type: int, length: 10, unsigned: 1, notnull: 1, am: {type: integer, htmltype: hidden}}
      code: {type: varchar, length: '255', notnull: 1, am: {type: string, req: 1, title: Код, trimNE: 'Поле "Код" не должно быть пустым'}}
      active: {type: enum('yes','no'), default: 'yes', notnull: 1, am: {type: checkbox, title: Отображать на сайте, otitle: Отображать на сайте, default: 'yes', checked: 'yes', unchecked: 'no', values: {no: нет, yes: да}}}

  banks2currencies:
    dont_install: 1
    fields:
      bank_id: {type: int, notnull: 1, unsigned: 1, am: {type: select, title: Банк}}
      currency_id: {type: int, notnull: 1, unsigned: 1, am: {type: select, title: Валюта}}
    table:
      UNIQUE:
        bank_currency: [bank_id, currency_id]

  accounts2country_source:
    fields:
      accounts_id: {type: int, notnull: 1, unsigned: 1, am: {type: select, title: Заявка на открытие счета}}
      country_id: {type: int, notnull: 1, unsigned: 1, am: {type: select, title: Страны источники входящих денежных переводов}}
    table:
      UNIQUE:
        accounts_country_source: [accounts_id, country_id]

  accounts2country_receiver:
    fields:
      accounts_id: {type: int, notnull: 1, unsigned: 1, am: {type: select, title: Заявка на открытие счета}}
      country_id: {type: int, notnull: 1, unsigned: 1, am: {type: select, title: Страны назначения исходящих денежных переводов}}
    table:
      UNIQUE:
        accounts_country_source: [accounts_id, country_id]

  accounts:
    fields:
      id: {type: int, length: 10, auto_increment: 1, notnull: 1, am: {type: integer}}
      account_req_id: {type: int, notnull: 1, unsigned: 1, am: {type: string, req: 1, title: Заявка на счет}}
      bank_id: {type: int, notnull: 1, unsigned: 1, am: {type: string, req: 1, title: Банк}}
      currency_id: {type: tinytext, notnull: 1, am: {type: string, req: 1, title: Валюта}}
    table:
      PRIMARY KEY: id
    foreign:
      bank: {table: banks, field: title, use_ref: accounts2banks, am: bank_id}
      currency: {table: currencies, field: title, use_ref: accounts2currencies, am: currency_id}
    actions:
      cms_account: [account_req_id, bank_id, currency_id]
      cabinet: [bank, currency]

  countries:
    dont_install: 1
    fields:
      id: {type: int, length: 10, auto_increment: 1, notnull: 1, am: {type: integer}}
      title: {type: tinytext, notnull: 1, am: {type: string, req: 1, title: Название}}
      pos: {type: int, length: 10, unsigned: 1, notnull: 1, am: {type: integer, htmltype: hidden}}
      active: {type: enum('yes','no'), default: 'yes', notnull: 1, am: {type: string, title: Отображать на сайте, htmltype: checkbox, default: 'yes', checked: 'yes', unchecked: 'no', values: {no: нет, yes: да}}}

  account2sources:
    fields:
      account_req_id: {type: int, lenght: 10, notnull: 1, unsigned: 1, am: {type: select, title: Заявка на открытие счета}}
      source_id: {type: int, lenght: 10, notnull: 1, unsigned: 1, am: {type: select, title: Источники происхождения ДС}}

  sources:
    dont_install: 1
    fields:
      id: {type: int, length: 10, auto_increment: 1, notnull: 1, am: {type: integer}}
      title: {type: tinytext, notnull: 1, am: {type: string, req: 1, title: Название}}
      pos: {type: int, length: 10, unsigned: 1, notnull: 1, am: {type: integer, htmltype: hidden}}
      active: {type: enum('yes','no'), default: 'yes', notnull: 1, am: {type: checkbox, title: Отображать на сайте, otitle: Отображать на сайте, default: 'yes', checked: 'yes', unchecked: 'no', values: {no: нет, yes: да}}}

refs:
  account2banks: {type: M-1, join: left outer, tables: {account_req: bank_id, banks: id}}
  accounts2banks: {type: M-1, join: left outer, tables: {accounts: bank_id, banks: id}}
  accounts2currencies: {type: M-1, join: left outer, tables: {accounts: currency_id, currencies: id}}
  banks2currencies:
    virtual: 1
    join: left outer
    type: N-M
    tables:
      -
        - {table: banks, field: id}
        - {table: banks2currencies, field: bank_id}
      -
        - {table: banks2currencies, field: currency_id}
        - {table: currencies, field: id}

  accounts2country_source:
    virtual: 1
    join: left outer
    type: N-M
    tables:
      -
        - {table: account_req, field: id}
        - {table: accounts2country_source, field: accounts_id}
      -
        - {table: accounts2country_source, field: country_id}
        - {table: countries, field: id, alias: country_source}

  accounts2country_receiver:
    virtual: 1
    join: left outer
    type: N-M
    tables:
      -
        - {table: account_req, field: id}
        - {table: accounts2country_receiver, field: accounts_id}
      -
        - {table: accounts2country_receiver, field: country_id}
        - {table: countries, field: id, alias: country_receiver}
  account2sources:
    virtual: 1
    join: left outer
    type: N-M
    tables:
      -
        - {table: account_req, field: id}
        - {table: account2sources, field: account_req_id}
      -
        - {table: account2sources, field: source_id}
        - {table: sources, field: id}

mail:
  message_accounts:
    from: 'no_reply@twt.ru'
    subject: 'Новая заявка на юр. лицо № [req_id]'
    type: text/html
    message: |
      <p>Здравствуйте</p>
      <br>Вы подали заявку на сайте [site_name]
      <br>Номер заявки: [req_id]
      <br>Дата заявки: [created]
      <br>Контактное лицо: [contact]
      <br>Контактный e-mail: [mail]
      <br>Счета: [accounts]
      <br>Ожидаемый оборот: [turnover]
      <br>Страны источники: [country_source]
      <br>Страны приемники: [country_receiver]
      <br>Источники происхождения ДС: [sources]
  message_admin:
    from: 'no_reply@twtconsult.com'
    subject: 'Поступила заявка на открытие счета № [req_id]'
    type: text/html
    message: |
      <p>[NO_REST]</p> 
      <p>Поступила заявка на открытие счета № [req_id]</p> <br />
      Номер заявки: [req_id] <br />
      Дата заявки: [created] <br />
      Контактное лицо: [contact] <br />
      Контактный e-mail: [mail] <br />
      Счета: [accounts] <br />
      Страны источники: [country_source] <br />
      Страны приемники: [country_receiver] <br />
      Источники происхождения ДС: [sources] <br />
      Свои источники происхождения ДС: [own_sources] 
      <div>Строка 1С: [json]</div>
  repl:
    site_name: "TWT"
  date_format: H:i:s d.m.Y
